<!DOCTYPE html>
<html lang="{{ lang }}" data-bs-theme="light">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>{% block title %}BergNavn Maritime{% endblock %}</title>

  <!-- Bootstrap & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  
  <!-- Leaflet CSS (for maps) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  
  <!-- Project Styles -->
  <link href="{{ url_for('static', filename='css/styles.css') }}" rel="stylesheet">

  {% block head %}{% endblock %}
</head>
<body>
<!-- Navigation Bar -->
<nav class="navbar navbar-expand-lg navbar-dark maritime-nav fixed-top">
  <div class="container">
    <!-- Logo -->
    <a class="navbar-brand d-flex align-items-center" href="{{ url_for('main_bp.home', lang=lang) }}">
      <span class="fs-3 me-2">ðŸŒŠ</span>
      <div>
        <span class="fw-bold">BergNavn</span>
        <small class="d-block text-muted opacity-75" style="font-size: 0.7rem; line-height: 1">Maritime Intelligence</small>
      </div>
    </a>

    <!-- Mobile Menu Toggle -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Navigation Links -->
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto align-items-center">
        <!-- Maritime Dashboard Link -->
        <li class="nav-item mx-1">
          <a class="nav-link d-flex align-items-center px-3 py-2"
             href="{{ url_for('maritime.maritime_dashboard', lang=lang) }}">
            <i class="bi bi-speedometer2 me-2 fs-6"></i>
            <span class="fw-semibold">Dashboard</span>
          </a>
        </li>

        <!-- Simulation Dashboard Link -->
        <li class="nav-item mx-1">
          <a class="nav-link d-flex align-items-center px-3 py-2"
             href="{{ url_for('maritime.simulation_dashboard', lang=lang) }}">
            <i class="bi bi-rocket-takeoff me-2 fs-6"></i>
            <span class="fw-semibold">Simulation</span>
          </a>
        </li>

        <!-- Routes Link -->
        <li class="nav-item mx-1">
          <a class="nav-link d-flex align-items-center px-3 py-2" 
             href="{{ url_for('routes_bp.view_routes', lang=lang) }}">
            <i class="fas fa-route me-2 fs-6"></i>
            <span class="fw-semibold">Routes</span>
          </a>
        </li>

        <!-- Home Link -->
        <li class="nav-item mx-1">
          <a class="nav-link d-flex align-items-center px-3 py-2" 
             href="{{ url_for('main_bp.home', lang=lang) }}">
            <i class="bi bi-house me-2 fs-6"></i>
            <span class="fw-semibold">Home</span>
          </a>
        </li>

        <!-- Language Selector -->
        <li class="nav-item dropdown mx-1">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
            <i class="bi bi-translate me-2 fs-6"></i>
            <span class="fw-semibold">{{ lang|upper }}</span>
          </a>
          <ul class="dropdown-menu dropdown-menu-end shadow">
            <li>
              <a class="dropdown-item" 
                 href="{{ url_for(request.endpoint or 'main_bp.home', lang='en') }}">
                <i class="bi bi-flag me-2 text-primary"></i>English
              </a>
            </li>
            <li>
              <a class="dropdown-item" 
                 href="{{ url_for(request.endpoint or 'main_bp.home', lang='no') }}">
                <i class="bi bi-flag-fill me-2 text-danger"></i>Norsk
              </a>
            </li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>

<!-- Main Content Area -->
<main class="container-fluid px-4 mt-5 pt-4">
  {% block content %}{% endblock %}
</main>

<!-- Footer -->
<footer class="maritime-footer py-4">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-6">
        <div class="d-flex align-items-center mb-2">
          <span class="fs-4 me-2">ðŸŒŠ</span>
          <div>
            <h6 class="mb-0 fw-bold">BergNavn Maritime</h6>
            <small class="opacity-75">Intelligent Route Optimization System</small>
          </div>
        </div>
        <small class="d-block opacity-75">
          <i class="bi bi-geo-alt me-1"></i>
          <span id="supported-ports">Norwegian Ports: Ã…lesund, Andalsnes, Bergen, Drammen, Flekkefjord, Kristiansand, Oslo, Sandefjord, Stavanger, Trondheim</span>
        </small>
        <small class="d-block opacity-75 mt-1">
          <i class="bi bi-cpu me-1"></i>Flask â€¢ PostgreSQL â€¢ BarentsWatch API â€¢ MET Norway
        </small>
      </div>
      
      <div class="col-md-6 text-md-end mt-3 mt-md-0">
        <div class="mb-2">
          <small class="d-block fw-semibold">System Status</small>
          <small class="d-block" id="system-status">
            <i class="bi bi-circle-fill text-success me-1"></i>
            <span id="status-text">All Systems Operational</span>
          </small>
        </div>
        <small class="d-block opacity-75">
          <i class="bi bi-clock me-1"></i>
          <span id="data-update-time">Data updated: --:--</span>
        </small>
        <small class="d-block opacity-75 mt-1">
          <i class="bi bi-code-slash me-1"></i>API Status: 
          <span class="badge bg-success" id="api-status">Active</span>
        </small>
      </div>
    </div>
    
    <hr class="my-3 opacity-25">
    
    <div class="row">
      <div class="col-md-8">
        <small class="opacity-75">Â© 2025 BergNavn Maritime | Research & Development Platform</small>
        <small class="d-block opacity-75 mt-1">
          <i class="bi bi-shield-check me-1"></i>
          Data sources: BarentsWatch AIS â€¢ MET Norway â€¢ Norwegian Coastal Admin
        </small>
      </div>
      <div class="col-md-4 text-md-end">
        <small class="opacity-75">
          <a href="{{ url_for('main_bp.about', lang=lang) }}" class="text-light text-decoration-none">About</a> â€¢ 
          <a href="{{ url_for('main_bp.contact', lang=lang) }}" class="text-light text-decoration-none ms-2">Contact</a> â€¢ 
          <a href="{{ url_for('main_bp.legal', lang=lang) }}" class="text-light text-decoration-none ms-2">Legal</a>
        </small>
      </div>
    </div>
  </div>
</footer>

<!-- Core JavaScript Libraries -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Common JavaScript -->
<script>
// Update footer timestamp and system status
function updateSystemStatus() {
    const now = new Date();
    const options = {
        hour: '2-digit',
        minute: '2-digit',
        timeZone: 'Europe/Oslo'
    };
    const timeString = now.toLocaleTimeString('en-GB', options);
    const dateString = now.toLocaleDateString('en-GB', { 
        day: 'numeric', 
        month: 'short',
        timeZone: 'Europe/Oslo'
    });
    
    // Update timestamp
    const timestampElement = document.getElementById('data-update-time');
    if (timestampElement) {
        timestampElement.textContent = `Data updated: ${dateString} ${timeString}`;
    }
    
    // Check API status - Use maritime.health_check endpoint
    fetch('/maritime/api/health')
        .then(response => {
            const apiStatusElement = document.getElementById('api-status');
            const statusElement = document.getElementById('status-text');
            
            if (response.ok) {
                apiStatusElement.className = 'badge bg-success';
                apiStatusElement.textContent = 'Active';
                statusElement.textContent = 'All Systems Operational';
                document.getElementById('system-status').innerHTML = 
                    '<i class="bi bi-circle-fill text-success me-1"></i>' + 
                    '<span id="status-text">All Systems Operational</span>';
            } else {
                apiStatusElement.className = 'badge bg-warning';
                apiStatusElement.textContent = 'Partial';
                statusElement.textContent = 'Service Degraded';
                document.getElementById('system-status').innerHTML = 
                    '<i class="bi bi-circle-fill text-warning me-1"></i>' + 
                    '<span id="status-text">Service Degraded</span>';
            }
        })
        .catch(() => {
            const apiStatusElement = document.getElementById('api-status');
            apiStatusElement.className = 'badge bg-danger';
            apiStatusElement.textContent = 'Offline';
            document.getElementById('system-status').innerHTML = 
                '<i class="bi bi-circle-fill text-danger me-1"></i>' + 
                '<span id="status-text">API Connection Failed</span>';
        });
}

// Initialize when page loads
document.addEventListener('DOMContentLoaded', function() {
    updateSystemStatus();
    // Update every 30 seconds
    setInterval(updateSystemStatus, 30000);
    
    // Add active class to current nav item
    const currentPath = window.location.pathname;
    document.querySelectorAll('.nav-link').forEach(link => {
        if (link.getAttribute('href') === currentPath) {
            link.classList.add('active');
        }
    });
});
</script>

{% block scripts %}{% endblock %}
</body>
</html>