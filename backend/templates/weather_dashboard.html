{% extends "base.html" %}

{% block title %}{{ translate('weather_dashboard', lang, 'dashboard') }}{% endblock %}

{% block content %}
<h2 class="mt-5 mb-4">üõ≥Ô∏è {{ translate('available_routes_legs', lang, 'dashboard') }}</h2>

<div class="table-responsive">
  <table class="table table-bordered table-hover">
    <thead class="table-dark">
      <tr>
        <th>{{ translate('route_id', lang, 'routes_page') }}</th>
        <th>{{ translate('route_name', lang, 'routes_page') }}</th>
        <th>{{ translate('description', lang, 'routes_page') }}</th>
        <th>{{ translate('number_of_legs', lang, 'routes_page') }}</th>
        <th>{{ translate('legs_details', lang, 'routes_page') }}</th>
      </tr>
    </thead>
    <tbody>
      {% for route in routes %}
      <tr class="{% if not route.active %}inactive{% endif %}">
        <td>{{ route.id }}</td>
        <td>{{ route.name }}</td>
        <td>{{ route.description or translate('not_available', lang, 'global') }}</td>
        <td>{{ route.legs|length }}</td>
        <td>
          {% if route.legs %}
          <ul class="mb-0">
            {% for leg in route.legs %}
            <li>
              {{ translate('leg', lang, 'routes_page') }} {{ leg.leg_order }}: 
              {{ leg.departure_port.name if leg.departure_port else translate('unknown', lang, 'global') }} &rarr; 
              {{ leg.arrival_port.name if leg.arrival_port else translate('unknown', lang, 'global') }} ,
              {{ translate('distance_nm', lang, 'routes_page') }}: {{ "%.1f"|format(leg.distance_nm or 0) }} nm,
              {{ translate('estimated_days', lang, 'routes_page') }}: 
              {{ ((leg.arrival_time - leg.departure_time).days) if leg.arrival_time and leg.departure_time else translate('not_available', lang, 'global') }}
            </li>
            {% endfor %}
          </ul>
          {% else %}
          <em class="text-muted">{{ translate('no_legs_available', lang, 'routes_page') }}</em>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
