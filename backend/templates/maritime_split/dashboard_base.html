{% extends "base.html" %}

{% block title %}Maritime Dashboard | BergNavn{% endblock %}

{% block head %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<link href="{{ url_for('static', filename='css/dashboard.css') }}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="container-fluid py-4">

    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12 text-center">
            <h1 class="fw-bold">ðŸŒŠ Maritime Dashboard (Real-time)</h1>
            <p class="text-muted">Live AIS â€¢ MET Weather â€¢ Fuel Optimizer â€¢ Route Analytics</p>
            <div id="api-status" class="badge bg-secondary">Initializing...</div>
        </div>
    </div>

    <!-- First row widgets -->
    <div class="row mb-3" id="widgets-row">
        <div class="col-lg-3 col-md-6 mb-3" id="weather-card-container">
            {% include "maritime_split/weather_block.html" %}
        </div>
        <div class="col-lg-3 col-md-6 mb-3" id="ships-card-container">
            {% include "maritime_split/ships_block.html" %}
        </div>
        <div class="col-lg-3 col-md-6 mb-3" id="fuel-card-container">
            {% include "maritime_split/fuel_block.html" %}
        </div>
        <div class="col-lg-3 col-md-6 mb-3" id="alerts-card-container">
            {% include "maritime_split/alerts_block.html" %}
        </div>
    </div>

    <!-- Map + ETA -->
    <div class="row mb-3">
        <div class="col-lg-8 mb-3">
            {% include "maritime_split/map_block.html" %}
        </div>
        <div class="col-lg-4 mb-3">
            {% include "maritime_split/eta_block.html" %}
        </div>
    </div>

</div>
{% endblock %}

{% block scripts %}
<!-- Core libraries -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Core maritime JS -->
<script src="{{ url_for('static', filename='js/maritime.js') }}"></script>

<!-- Split modules -->
<script src="{{ url_for('static', filename='js/split/maritime_core.js') }}"></script>
<script src="{{ url_for('static', filename='js/split/maritime_map.js') }}"></script>
<script src="{{ url_for('static', filename='js/split/maritime_weather.js') }}"></script>
<script src="{{ url_for('static', filename='js/split/maritime_analytics.js') }}"></script>

<!-- Dashboard logic -->
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        if (window.initMap) {
            window.initMap();
        } else {
            console.error("initMap() missing â€” check static/js/maritime.js");
        }
    });
</script>
{% endblock %}
