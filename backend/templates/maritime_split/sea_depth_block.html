<!-- templates/blocks/sea_depth_block.html -->
<!-- English-only comments: Sea depth block - calls /maritime/sea-depth?lat=..&lon=..
     API should return { depth_meters, source, confidence } -->
<div id="sea_depth_block" class="card maritime-card shadow-sm">
  <div class="card-header bg-primary text-white">
    <i class="bi bi-geo-alt"></i> Sea Depth
  </div>
  <div class="card-body">
    <div id="sea_depth_block_content" class="small">
      <div class="text-center">
        <div class="spinner-border text-primary" role="status"></div>
        <div class="mt-2">Calculating depth...</div>
      </div>
    </div>
  </div>
</div>

<script>
/* English-only comments:
   This block is adapted for the 10 supported cities.
   It will call /maritime/sea-depth with lat/lon for the selected city.
   If your frontend has a city selector, adapt call accordingly.
*/
(async function loadSeaDepthBlock() {
  const container = document.getElementById('sea_depth_block_content');

  // Default: query center MET coordinates (env) if sea-depth endpoint supports lat/lon optional
  // Prefer to pass specific coordinates from UI later.
  try {
    // If a city selector exists on the page with id 'city', use it; otherwise call without coords.
    const citySelector = document.getElementById('city');
    let url = '/maritime/sea-depth';
    if (citySelector && citySelector.value) {
      const coords = {
        bergen: [60.39, 5.32],
        oslo: [59.91, 10.75],
        stavanger: [58.97, 5.73],
        trondheim: [63.43, 10.39],
        kristiansand: [58.15, 8.00],
        alesund: [62.47, 6.16],
        drammen: [59.74, 10.20],
        sandefjord: [59.13, 10.22],
        flekkefjord: [58.30, 6.66],
        andalsnes: [62.56, 7.69]
      };
      const key = citySelector.value.toLowerCase();
      if (coords[key]) {
        url += `?lat=${coords[key][0]}&lon=${coords[key][1]}`;
      }
    }

    const res = await fetchSafeJson(url);
    if (!res.ok) {
      container.innerHTML = `<div class="text-warning">Depth unavailable — ${res.message || 'fallback'}</div>`;
      return;
    }
    const d = res.data || {};
    container.innerHTML = `
      <div><strong>Depth:</strong> ${typeof d.depth_meters !== 'undefined' ? d.depth_meters + ' m' : (d.depth || '—')}</div>
      <div class="small text-muted">Source: ${d.source || 'empirical' } • Confidence: ${d.confidence || 'medium'}</div>
    `;
  } catch (e) {
    container.innerHTML = `<div class="text-warning">Depth calculation error</div>`;
  }
})();
</script>
