<!-- templates/blocks/alerts_block.html -->
<!-- English-only comments: Alerts block - uses /maritime/api/alerts and shows top priority alerts -->
<div id="alerts_block" class="card maritime-card shadow-sm">
  <div class="card-header bg-danger text-white">
    <i class="bi bi-exclamation-triangle"></i> Alerts
  </div>
  <div class="card-body">
    <div id="alerts_block_list" class="small">
      <div class="text-center">
        <div class="spinner-border text-danger" role="status"></div>
        <div class="mt-2">Checking alerts...</div>
      </div>
    </div>
  </div>
</div>

<script>
/* English-only comments:
   Fetches /maritime/api/alerts. Expects data.alerts = [{type, priority, message, timestamp}, ...]
*/
(async function loadAlertsBlock() {
  const container = document.getElementById('alerts_block_list');
  const res = await fetchSafeJson('/maritime/api/alerts');
  if (!res.ok) {
    container.innerHTML = `<div class="text-warning">Alerts unavailable — ${res.message || 'fallback'}</div>`;
    return;
  }
  const alerts = (res.data && res.data.alerts) || [];
  if (!alerts.length) {
    container.innerHTML = `<div class="text-success">No active alerts</div>`;
    return;
  }
  // show up to 5 alerts, sorted by priority if present
  const order = { high: 3, medium: 2, low: 1 };
  alerts.sort((a,b) => (order[b.priority]||0) - (order[a.priority]||0));
  container.innerHTML = alerts.slice(0,5).map(a => `
    <div class="mb-2">
      <strong>${a.type || 'Alert'}</strong> — ${a.message || ''}
      <div class="text-muted small">${a.priority ? 'Priority: ' + a.priority : ''} ${a.timestamp ? ' • ' + new Date(a.timestamp).toLocaleString() : ''}</div>
    </div>
  `).join('');
})();
</script>
