// backend/static/js/split/dashboard_utils.js
/**
 * Utility functions for BergNavn Maritime Dashboard
 */

// Norwegian time formatting
function getNorwegianTime() {
    const now = new Date();
    return new Intl.DateTimeFormat('en-GB', {
        timeZone: 'Europe/Oslo',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        hour12: false
    }).format(now);
}

function getNorwegianDate() {
    const now = new Date();
    return new Intl.DateTimeFormat('en-GB', {
        timeZone: 'Europe/Oslo',
        weekday: 'short',
        month: 'short',
        day: 'numeric'
    }).format(now);
}

// Format distance in nautical miles
function formatDistanceNM(distance) {
    if (distance >= 1000) {
        return `${(distance / 1000).toFixed(1)}k NM`;
    }
    return `${distance.toFixed(1)} NM`;
}

// Format speed in knots
function formatSpeedKnots(speed) {
    return `${speed.toFixed(1)} kn`;
}

// Format temperature
function formatTemperature(temp) {
    return `${temp.toFixed(1)}Â°C`;
}

// Safe JSON fetch with error handling
async function fetchSafeJson(url, options = {}) {
    try {
        const response = await fetch(url, options);
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
        }
        return {
            ok: true,
            data: await response.json()
        };
    } catch (error) {
        console.error(`Fetch error for ${url}:`, error);
        return {
            ok: false,
            error: error.message,
            message: 'Failed to fetch data'
        };
    }
}

// Export for global use
window.DashboardUtils = {
    getNorwegianTime,
    getNorwegianDate,
    formatDistanceNM,
    formatSpeedKnots,
    formatTemperature,
    fetchSafeJson
};